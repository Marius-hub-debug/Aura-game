<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire de l'Aura - Online</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
    
        body {
            font-family: 'Courier New', monospace;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        
        /* √âCRAN DE CONNEXION */
        #loginScreen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            z-index: 10000;
        }
        
        #loginScreen.hidden { display: none; }
        
        .login-box {
            background: rgba(138, 43, 226, 0.15);
            border: 2px solid rgba(147, 51, 234, 0.4);
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 0 40px rgba(147, 51, 234, 0.3);
        }
        
        .login-title {
            font-size: 2.5em;
            background: linear-gradient(45deg, #00d4ff, #7b2ff7, #f107a3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            color: #c084fc;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(192, 132, 252, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 1em;
            font-family: 'Courier New', monospace;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #7b2ff7;
            box-shadow: 0 0 10px rgba(123, 47, 247, 0.5);
        }
        
        .btn-login {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #7b2ff7, #f107a3);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
        }
        
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(123, 47, 247, 0.5);
        }
        
   .toggle-mode-btn {
    width: 100%;
    text-align: center;
    margin-top: 15px;
    padding: 10px;
    color: #c084fc;
    cursor: pointer;
    background: transparent;
    border: none;
    font-family: 'Courier New', monospace;
    font-size: 1em;
}

.toggle-mode-btn:hover {
    color: #e879f9;
    text-decoration: underline;
}
        .error-msg {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            border-radius: 8px;
            padding: 10px;
            color: #fca5a5;
            margin-bottom: 15px;
            display: none;
        }
        
        /* LEADERBOARD */
        .leaderboard-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 25px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border: none;
            border-radius: 10px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            z-index: 1000;
            font-family: 'Courier New', monospace;
        }
        
        .leaderboard-btn:hover {
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.8);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active { display: flex; }
        
        .modal-content {
            background: rgba(26, 95, 138, 0.95);
            border: 3px solid #c084fc;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-size: 2em;
            color: #fbbf24;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .leaderboard-list {
            list-style: none;
        }
        
        .leaderboard-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #7b2ff7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .leaderboard-item:nth-child(1) { border-left-color: #fbbf24; }
        .leaderboard-item:nth-child(2) { border-left-color: #c0c0c0; }
        .leaderboard-item:nth-child(3) { border-left-color: #cd7f32; }
        .player-prestige {
    margin-left: 12px;
    padding: 6px 10px;
    border-radius: 999px;
    font-weight: bold;
    min-width: 110px;
    text-align: center;
    color: #000;
    display:inline-block;
}

.prestige-default { background: linear-gradient(135deg, #7b2ff7, #f107a3); color: #fff; }
.prestige-bronze  { background: linear-gradient(135deg, #cd7f32, #a55b2a); color: #000; }
.prestige-silver  { background: linear-gradient(135deg, #c0c0c0, #9ea0a5); color: #000; }
.prestige-gold    { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #000; }
.prestige-legend  { background: linear-gradient(135deg, #ffd700, #ff8800); color: #000; box-shadow: 0 6px 20px rgba(255,200,0,0.35); }

        .rank {
            font-size: 1.5em;
            font-weight: bold;
            color: #fbbf24;
            margin-right: 15px;
        }
        
        .player-name {
            flex: 1;
            font-size: 1.2em;
            color: #c084fc;
        }
        
        .player-score {
            font-size: 1.3em;
            color: #00d4ff;
            font-weight: bold;
        }
        
        .close-modal {
            margin-top: 20px;
            padding: 12px;
            background: rgba(239, 68, 68, 0.3);
            border: 2px solid #ef4444;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            width: 100%;
            font-family: 'Courier New', monospace;
            font-size: 1em;
        }
        
        /* Reste du CSS du jeu... (garde tout le CSS existant) */
        /* Je ne le r√©p√®te pas ici pour gagner de la place */
        
    </style>
</head>
<body>
<!-- √âCRAN DE CONNEXION -->
<div id="loginScreen">
    <div class="login-box">
        <h1 class="login-title">‚ú® EMPIRE DE L'AURA ‚ú®</h1>

        <div class="error-msg" id="errorMsg"></div>

        <!-- FORMULAIRE DE CONNEXION -->
        <div id="loginForm">
            <div class="input-group">
                <label>üë§ Pseudo</label>
                <input type="text" id="loginUsername" placeholder="3-20 caract√®res" maxlength="20">
            </div>
            <div class="input-group">
                <label>üîí Mot de passe</label>
                <input type="password" id="loginPassword" placeholder="Mot de passe">
            </div>
            <button type="button" class="btn-login" onclick="login()">üöÄ CONNEXION</button>
            <button type="button" class="toggle-mode-btn" onclick="toggleMode()">Pas de compte ? <strong>Cr√©er un compte</strong></button>
        </div>

        <!-- FORMULAIRE D'INSCRIPTION -->
        <div id="registerForm" style="display: none;">
            <div class="input-group">
                <label>üë§ Pseudo</label>
                <input type="text" id="registerUsername" placeholder="3-20 caract√®res" maxlength="20">
            </div>
            <div class="input-group">
                <label>üîí Mot de passe</label>
                <input type="password" id="registerPassword" placeholder="Minimum 6 caract√®res">
            </div>
            <div class="input-group">
                <label>üîí Confirmer mot de passe</label>
                <input type="password" id="registerPasswordConfirm" placeholder="Retaper le mot de passe">
            </div>
            <button type="button" class="btn-login" onclick="register()">‚ú® CR√âER COMPTE</button>
            <button type="button" class="toggle-mode-btn" onclick="toggleMode()">D√©j√† un compte ? <strong>Se connecter</strong></button>
        </div>
    </div>
</div>


    
    <!-- BOUTON CLASSEMENT -->
    <button class="leaderboard-btn" id="leaderboardBtn" style="display: none;" onclick="showLeaderboard()">
        üèÜ Classement
    </button>
    
    <!-- MODAL CLASSEMENT -->
    <div class="modal" id="leaderboardModal">
        <div class="modal-content">
            <h2 class="modal-title">üèÜ CLASSEMENT MONDIAL üèÜ</h2>
            <ul class="leaderboard-list" id="leaderboardList"></ul>
            <button class="close-modal" onclick="closeLeaderboard()">Fermer</button>
        </div>
    </div>
    
    <!-- JEU (tout le HTML du jeu existant) -->
    <!-- Garde exactement le m√™me HTML du jeu -->
<script>
function notify(msg) {
    console.log(msg);
}

// ========== CONFIGURATION SUPABASE ==========
const SUPABASE_URL = 'https://uvokzzjgbcyuvheppynm.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV2b2t6empnYmN5dXZoZXBweW5tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2NjM4MDIsImV4cCI6MjA4NDIzOTgwMn0.HU2fWuYugDi9dP3lx3xg9Wmxq4xAN9nDYgdEm-YcRPU';

const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    

let isLoginMode = true;
let userToken = localStorage.getItem('authToken') || null;
let currentUsername = localStorage.getItem('username') || null;

// ========== AUTHENTIFICATION ==========
function toggleMode() {
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');

    isLoginMode = !isLoginMode;

    if (isLoginMode) {
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
    } else {
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
    }

    hideError();
}

function showError(msg) {
    const errorEl = document.getElementById('errorMsg');
    errorEl.textContent = msg;
    errorEl.style.display = 'block';
}

function hideError() {
    document.getElementById('errorMsg').style.display = 'none';
}

async function register() {
    const username = document.getElementById('registerUsername').value.trim();
    const password = document.getElementById('registerPassword').value;
    const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
    
    hideError();
    
    if (username.length < 3 || username.length > 20) {
        showError('Le pseudo doit faire entre 3 et 20 caract√®res');
        return;
    }
    
    if (password.length < 6) {
        showError('Le mot de passe doit faire au moins 6 caract√®res');
        return;
    }
    
    if (password !== passwordConfirm) {
        showError('Les mots de passe ne correspondent pas');
        return;
    }
    
    try {
        const { data, error } = await client.rpc('create_user', {
            p_username: username,
            p_password: password
        });
        
        if (error) throw error;
        
        if (data[0].success) {
            userToken = data[0].token;
            currentUsername = username;
            localStorage.setItem('authToken', userToken);
            localStorage.setItem('username', currentUsername);
            
            startGame();
        } else {
            showError(data[0].message);
        }
    } catch (err) {
        showError('Erreur de connexion au serveur');
        console.error(err);
    }
}

async function login() {
    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value;
    
    hideError();
    
    if (!username || !password) {
        showError('Veuillez remplir tous les champs');
        return;
    }
    
    try {
        const { data, error } = await client.rpc('login_user', {
            p_username: username,
            p_password: password
        });
        
        if (error) throw error;
        
        if (data[0].success) {
            userToken = data[0].token;
            currentUsername = username;
            localStorage.setItem('authToken', userToken);
            localStorage.setItem('username', currentUsername);
            
            await loadGameFromServer();
            startGame();
        } else {
            showError(data[0].message);
        }
    } catch (err) {
        showError('Erreur de connexion au serveur');
        console.error(err);
    }
}

function logout() {
    localStorage.removeItem('authToken');
    localStorage.removeItem('username');
    userToken = null;
    currentUsername = null;
    
    document.getElementById('loginScreen').classList.remove('hidden');
    document.getElementById('leaderboardBtn').style.display = 'none';
    
    location.reload();
}

function startGame() {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('leaderboardBtn').style.display = 'block';
    
    notify(`Bienvenue ${currentUsername} !`);
    
    setInterval(saveGameToServer, 30000);
}

async function checkExistingSession() {
    const token = localStorage.getItem('authToken');
    if (!token) return; // Pas de session existante

    try {
        // V√©rifie avec la fonction SQL verify_token si le token est valide
        const { data, error } = await client.rpc('verify_token', { p_token: token });
        if (error || !data) {
            logout(); // token invalide ‚Üí d√©connexion
            return;
        }

        userToken = token;
        currentUsername = localStorage.getItem('username');
        await loadGameFromServer();
        startGame();
    } catch (err) {
        console.error('Session invalide:', err);
        logout();
    }
}


// ========== SAUVEGARDE ==========
async function saveGameToServer() {
    if (!userToken) return;
    
    try {
        const { data, error } = await client.rpc('save_game', {
            p_token: userToken,
            p_game_data: game,
            p_total_aura: Math.floor(game.totalAura),
            p_prestige_level: game.stats.totalPrestiges,
            p_crystals: game.crystals
        });
        
        if (error) throw error;
        
        console.log('‚úÖ Jeu sauvegard√© sur le serveur');
    } catch (err) {
        console.error('‚ùå Erreur de sauvegarde:', err);
        if (err.message.includes('token')) {
            logout();
        }
    }
}

async function loadGameFromServer() {
    if (!userToken) return;
    
    try {
        const { data, error } = await client.rpc('load_game', {
            p_token: userToken
        });
        
        if (error) throw error;
        
        if (data && data.length > 0 && data[0].game_data) {
            const savedData = data[0].game_data;
            if (Object.keys(savedData).length > 0) {
                Object.assign(game, savedData);
                updateDisplay();
                notify('üíæ Partie charg√©e !');
            }
        }
    } catch (err) {
        console.error('‚ùå Erreur de chargement:', err);
    }
}

// ========== CLASSEMENT ==========
async function showLeaderboard() {
    try {
        const { data, error } = await client
            .from('leaderboard')
            .select('*')
            .limit(50);
        
        if (error) throw error;
        
        const list = document.getElementById('leaderboardList');
        list.innerHTML = '';
        
data.forEach((player, index) => {
    const prestigeRaw = player.prestige_level ?? player.prestuge_level ?? player.prestiges ?? player.prestige ?? 0;
    const prestigeClass = getPrestigeClass(prestigeRaw);
    const prestigeText = `${formatNumber(prestigeRaw)} Prestige`;

    const li = document.createElement('li');
    li.className = 'leaderboard-item';
    li.innerHTML = `
        <div style="display:flex; align-items:center; gap:12px; flex:1;">
            <span class="rank">#${index + 1}</span>
            <span class="player-name">${escapeHtml(player.username ?? '‚Äî')}</span>
        </div>
        <div style="display:flex; align-items:center; gap:8px;">
            <span class="player-prestige ${prestigeClass}">${escapeHtml(prestigeText)}</span>
            <span class="player-score">${formatNumber(player.total_aura ?? player.totalAura ?? 0)} Aura</span>
        </div>
    `;
    list.appendChild(li);
});

        
        document.getElementById('leaderboardModal').classList.add('active');
    } catch (err) {
        console.error('Erreur chargement classement:', err);
        notify('‚ùå Erreur de chargement du classement');
    }
}

function closeLeaderboard() {
    document.getElementById('leaderboardModal').classList.remove('active');
}

function formatNumber(n) {
    if (n >= 1e12) return (n / 1e12).toFixed(2) + 'T';
    if (n >= 1e9) return (n / 1e9).toFixed(2) + 'B';
    if (n >= 1e6) return (n / 1e6).toFixed(2) + 'M';
    if (n >= 1e3) return (n / 1e3).toFixed(2) + 'k';
    return Math.floor(n).toLocaleString();
}
</script>
        // ========== TOUT LE CODE DU JEU EXISTANT ==========
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire de l'Aura - Ultimate</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #00d4ff, #7b2ff7, #f107a3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }
        
        .subtitle {
            color: #a0a0a0;
            font-size: 0.9em;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #7b2ff7, #f107a3);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(123, 47, 247, 0.5);
            animation: slideIn 0.5s;
            z-index: 1000;
            max-width: 300px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            transition: all 0.3s;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(123, 47, 247, 0.3);
        }
        
        .card-title {
            font-size: 1.3em;
            margin-bottom: 12px;
            color: #00d4ff;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            font-size: 0.9em;
        }
        
        .stat-label {
            color: #a0a0a0;
        }
        
        .stat-value {
            color: #00d4ff;
            font-weight: bold;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #7b2ff7, #f107a3);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        button {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            font-size: 0.9em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(123, 47, 247, 0.4);
        }
        
        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #7b2ff7, #f107a3);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff4757, #ff6348);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffa502, #ff6348);
            color: white;
        }
        
        .upgrade-list {
            max-height: 350px;
            overflow-y: auto;
        }
        
        .upgrade-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .upgrade-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .upgrade-name {
            font-weight: bold;
            color: #00d4ff;
            font-size: 0.95em;
        }
        
        .upgrade-level {
            color: #f107a3;
            font-size: 0.9em;
        }
        
        .upgrade-desc {
            color: #a0a0a0;
            font-size: 0.85em;
            margin-bottom: 8px;
        }
        
        .upgrade-cost {
            color: #ffaa00;
            font-size: 0.85em;
        }
        
        .achievement {
            background: linear-gradient(135deg, rgba(123, 47, 247, 0.2), rgba(241, 7, 163, 0.2));
            padding: 8px;
            margin-bottom: 6px;
            border-radius: 6px;
            border-left: 3px solid #f107a3;
            font-size: 0.85em;
        }
        
        .achievement.locked {
            opacity: 0.4;
        }
        
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #7b2ff7, #f107a3);
            border-color: #f107a3;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #7b2ff7, #f107a3);
            border-radius: 10px;
        }
        
        .event-banner {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .enemy {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff4757;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .enemy-name {
            font-size: 1.2em;
            color: #ff4757;
            margin-bottom: 10px;
        }
        
        .artifact {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
            border: 2px solid #ffd700;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .artifact-name {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .dimension-card {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(75, 0, 130, 0.2));
            border: 2px solid #8a2be2;
        }
        
        .challenge-item {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid #ff6b6b;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .challenge-active {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }
        
        .bot-item {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid #00d4ff;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .chart-container {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ú® Empire de l'Aura - Ultimate Edition ‚ú®</h1>
            <p class="subtitle">Dominez le multivers et ascendez vers l'infini</p>
        </header>
        
        <div id="eventBanner"></div>
        <div id="notifications"></div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('main')">Principal</div>
            <div class="tab" onclick="switchTab('upgrades')">Am√©liorations</div>
            <div class="tab" onclick="switchTab('combat')">‚öîÔ∏è Combat</div>
            <div class="tab" onclick="switchTab('dimensions')">üåç Dimensions</div>
            <div class="tab" onclick="switchTab('artifacts')">üíé Artefacts</div>
            <div class="tab" onclick="switchTab('automation')">üè≠ Automatisation</div>
            <div class="tab" onclick="switchTab('challenges')">üéØ D√©fis</div>
            <div class="tab" onclick="switchTab('stats')">üìä Stats</div>
            <div class="tab" onclick="switchTab('achievements')">üèÜ Succ√®s</div>
        </div>
        
        <div id="main" class="tab-content active">
            <div class="grid">
                <div class="card">
                    <h2 class="card-title">üí´ Ressources</h2>
                    <div class="stat">
                        <span class="stat-label">Aura:</span>
                        <span class="stat-value" id="aura">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Aura/sec:</span>
                        <span class="stat-value" id="auraRate">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Essence:</span>
                        <span class="stat-value" id="essence">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Cristaux:</span>
                        <span class="stat-value" id="crystals">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Fragments cosmiques:</span>
                        <span class="stat-value" id="fragments">0</span>
                    </div>
                    <button class="btn-primary" onclick="collectAura()">R√©colter l'Aura</button>
                    <button class="btn-secondary" onclick="convertToEssence()" id="convertBtn" disabled>
                        Convertir en Essence (1000 Aura)
                    </button>
                </div>
                
                <div class="card">
                    <h2 class="card-title">‚ö° Production</h2>
                    <div class="stat">
                        <span class="stat-label">Collecteurs:</span>
                        <span class="stat-value" id="collectors">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Amplificateurs:</span>
                        <span class="stat-value" id="amplifiers">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">R√©sonateurs:</span>
                        <span class="stat-value" id="resonators">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Multiplicateur total:</span>
                        <span class="stat-value" id="multiplier">√ó1.0</span>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">üåü Prestige</h2>
                    <div class="upgrade-desc">
                        R√©initialisez pour obtenir des Cristaux de puissance !
                    </div>
                    <div class="stat">
                        <span class="stat-label">Cristaux gagn√©s:</span>
                        <span class="stat-value" id="prestigeGain">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Bonus cristaux:</span>
                        <span class="stat-value" id="crystalBonus">+0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="prestigeProgress" style="width: 0%">0%</div>
                    </div>
                    <button class="btn-success" onclick="prestige()" id="prestigeBtn" disabled>
                        Ascension (1M Aura)
                    </button>
                </div>
            </div>
        </div>
        
        <div id="upgrades" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2 class="card-title">üîß G√©n√©rateurs</h2>
                    <div class="upgrade-list">
                        <div class="upgrade-item">
                            <div class="upgrade-header">
                                <span class="upgrade-name">Collecteur</span>
                                <span class="upgrade-level">Niv. <span id="collectorLevel">0</span></span>
                            </div>
                            <div class="upgrade-desc">+1 Aura/sec</div>
                            <div class="upgrade-cost">Co√ªt: <span id="collectorCost">10</span> Aura</div>
                            <button class="btn-primary" onclick="buyCollector()">Acheter</button>
                        </div>
                        
                        <div class="upgrade-item">
                            <div class="upgrade-header">
                                <span class="upgrade-name">Amplificateur</span>
                                <span class="upgrade-level">Niv. <span id="amplifierLevel">0</span></span>
                            </div>
                            <div class="upgrade-desc">+10 Aura/sec</div>
                            <div class="upgrade-cost">Co√ªt: <span id="amplifierCost">100</span> Aura</div>
                            <button class="btn-primary" onclick="buyAmplifier()">Acheter</button>
                        </div>
                        
                        <div class="upgrade-item">
                            <div class="upgrade-header">
                                <span class="upgrade-name">R√©sonateur</span>
                                <span class="upgrade-level">Niv. <span id="resonatorLevel">0</span></span>
                            </div>
                            <div class="upgrade-desc">+100 Aura/sec</div>
                            <div class="upgrade-cost">Co√ªt: <span id="resonatorCost">5</span> Essence</div>
                            <button class="btn-secondary" onclick="buyResonator()">Acheter</button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">‚öôÔ∏è Am√©liorations</h2>
                    <div class="upgrade-list">
                        <div class="upgrade-item">
                            <div class="upgrade-header">
                                <span class="upgrade-name">Clics puissants</span>
                                <span class="upgrade-level">Niv. <span id="clickLevel">0</span></span>
                            </div>
                            <div class="upgrade-desc">+1 Aura par clic</div>
                            <div class="upgrade-cost">Co√ªt: <span id="clickCost">50</span> Aura</div>
                            <button class="btn-primary" onclick="buyClickPower()">Acheter</button>
                        </div>
                        
                        <div class="upgrade-item">
                            <div class="upgrade-header">
                                <span class="upgrade-name">Efficacit√©</span>
                                <span class="upgrade-level">Niv. <span id="efficiencyLevel">0</span></span>
                            </div>
                            <div class="upgrade-desc">√ó1.5 production</div>
                            <div class="upgrade-cost">Co√ªt: <span id="efficiencyCost">2</span> Essence</div>
                            <button class="btn-secondary" onclick="buyEfficiency()">Acheter</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="combat" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2 class="card-title">‚öîÔ∏è Combat</h2>
                    <div class="stat">
                        <span class="stat-label">Puissance d'attaque:</span>
                        <span class="stat-value" id="attackPower">1</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">D√©fense:</span>
                        <span class="stat-value" id="defense">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Victoires:</span>
                        <span class="stat-value" id="victories">0</span>
                    </div>
                    <button class="btn-danger" onclick="findEnemy()">Chercher un ennemi</button>
                </div>
                
                <div class="card">
                    <h2 class="card-title">üëπ Ennemi actuel</h2>
                    <div id="enemyInfo">Aucun ennemi</div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">üõ°Ô∏è √âquipement</h2>
                    <div class="upgrade-list">
                        <div class="upgrade-item">
                            <div class="upgrade-name">√âp√©e cosmique</div>
                            <div class="upgrade-desc">+5 Attaque</div>
                            <div class="upgrade-cost">Co√ªt: 10 Essence</div>
                            <button class="btn-secondary" onclick="buyWeapon()" id="weaponBtn">Acheter</button>
                        </div>
                        <div class="upgrade-item">
                            <div class="upgrade-name">Armure √©nerg√©tique</div>
                            <div class="upgrade-desc">+3 D√©fense</div>
                            <div class="upgrade-cost">Co√ªt: 10 Essence</div>
                            <button class="btn-secondary" onclick="buyArmor()" id="armorBtn">Acheter</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="dimensions" class="tab-content">
            <div class="grid">
                <div class="card dimension-card">
                    <h2 class="card-title">üåç Dimension √âth√©r√©e</h2>
                    <div class="upgrade-desc">Premi√®re dimension alternative</div>
                    <div class="stat">
                        <span class="stat-label">√âther:</span>
                        <span class="stat-value" id="ether">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">G√©n√©rateurs:</span>
                        <span class="stat-value" id="etherGens">0</span>
                    </div>
                    <button class="btn-warning" onclick="unlockDimension(1)" id="dim1Btn">D√©bloquer (50 Cristaux)</button>
                    <button class="btn-primary" onclick="buyEtherGen()" id="etherGenBtn" disabled>G√©n√©rateur (100 √âther)</button>
                </div>
                
                <div class="card dimension-card">
                    <h2 class="card-title">üåå Dimension Astrale</h2>
                    <div class="upgrade-desc">Seconde dimension alternative</div>
                    <div class="stat">
                        <span class="stat-label">Astral:</span>
                        <span class="stat-value" id="astral">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Extracteurs:</span>
                        <span class="stat-value" id="astralGens">0</span>
                    </div>
                    <button class="btn-warning" onclick="unlockDimension(2)" id="dim2Btn" disabled>D√©bloquer (200 Cristaux)</button>
                    <button class="btn-primary" onclick="buyAstralGen()" id="astralGenBtn" disabled>Extracteur (500 Astral)</button>
                </div>
            </div>
        </div>
        
        <div id="artifacts" class="tab-content">
            <div class="card">
                <h2 class="card-title">üíé Artefacts L√©gendaires</h2>
                <div class="stat">
                    <span class="stat-label">Fragments cosmiques:</span>
                    <span class="stat-value" id="fragmentsDisplay">0</span>
                </div>
                <button class="btn-warning" onclick="searchArtifact()">Chercher un artefact (50 Fragments)</button>
                <div id="artifactList" class="upgrade-list" style="margin-top: 15px;"></div>
            </div>
        </div>
        
        <div id="automation" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2 class="card-title">üè≠ Scripts d'automatisation</h2>
                    <div class="upgrade-list">
                        <div class="bot-item">
                            <div class="upgrade-name">Auto-Collecteur</div>
                            <div class="upgrade-desc">Collecte automatiquement l'Aura</div>
                            <div class="upgrade-cost">Co√ªt: 1 Essence</div>
                            <button class="btn-secondary" onclick="unlockBot('autoCollect')" id="bot1Btn">Activer</button>
                        </div>
                        <div class="bot-item">
                            <div class="upgrade-name">Auto-Acheteur</div>
                            <div class="upgrade-desc">Ach√®te automatiquement des collecteurs</div>
                            <div class="upgrade-cost">Co√ªt: 5 Essence</div>
                            <button class="btn-secondary" onclick="unlockBot('autoBuy')" id="bot2Btn" disabled>Activer</button>
                        </div>
                        <div class="bot-item">
                            <div class="upgrade-name">Auto-Combat</div>
                            <div class="upgrade-desc">Combat automatiquement les ennemis</div>
                            <div class="upgrade-cost">Co√ªt: 10 Essence</div>
                            <button class="btn-secondary" onclick="unlockBot('autoBattle')" id="bot3Btn" disabled>Activer</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="challenges" class="tab-content">
            <div class="card">
                <h2 class="card-title">üéØ D√©fis</h2>
                <div class="upgrade-list">
                    <div class="challenge-item" id="challenge1">
                        <div class="upgrade-name">D√©fi: Minimaliste</div>
                        <div class="upgrade-desc">Atteindre 10k Aura sans collecteurs</div>
                        <div class="upgrade-cost">R√©compense: +50% clics permanents</div>
                        <button class="btn-warning" onclick="startChallenge(1)">D√©marrer</button>
                    </div>
                    <div class="challenge-item" id="challenge2">
                        <div class="upgrade-name">D√©fi: Guerrier</div>
                        <div class="upgrade-desc">Vaincre 50 ennemis</div>
                        <div class="upgrade-cost">R√©compense: +100% puissance d'attaque</div>
                        <button class="btn-warning" onclick="startChallenge(2)">D√©marrer</button>
                    </div>
                    <div class="challenge-item" id="challenge3">
                        <div class="upgrade-name">D√©fi: Speed Run</div>
                        <div class="upgrade-desc">Atteindre 1M Aura en moins de 5 min</div>
                        <div class="upgrade-cost">R√©compense: x2 Aura/sec permanent</div>
                        <button class="btn-warning" onclick="startChallenge(3)">D√©marrer</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="stats" class="tab-content">
            <div class="card">
                <h2 class="card-title">üìä Statistiques</h2>
                <div class="stat">
                    <span class="stat-label">Aura totale r√©colt√©e:</span>
                    <span class="stat-value" id="totalAuraCollected">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Clics effectu√©s:</span>
                    <span class="stat-value" id="totalClicks">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Ennemis vaincus:</span>
                    <span class="stat-value" id="totalEnemies">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Prestiges effectu√©s:</span>
                    <span class="stat-value" id="totalPrestiges">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Temps de jeu:</span>
                    <span class="stat-value" id="playTime">0s</span>
                </div>
                <div class="chart-container">
                    <h3 style="margin-bottom: 10px;">Production des 30 derni√®res secondes</h3>
                    <canvas id="productionChart" width="400" height="150"></canvas>
                </div>
            </div>
        </div>
        
        <div id="achievements" class="tab-content">
            <div class="card">
                <h2 class="card-title">üèÜ Succ√®s</h2>
                <div id="achievementList"></div>
            </div>
        </div>
    </div>

    <script>
        // ===== √âtat de jeu minimal requis par la sauvegarde/chargement & l‚ÄôUI =====
        

        const game = {
            aura: 0,
            essence: 0,
            crystals: 0,
            fragments: 0,
            ether: 0,
            astral: 0,
            totalAura: 0,
            
            clickPower: 1,
            collectors: 0,
            amplifiers: 0,
            resonators: 0,
            etherGens: 0,
            astralGens: 0,
            
            clickUpgrade: 0,
            efficiencyUpgrade: 0,
            
            collectorCost: 10,
            amplifierCost: 100,
            resonatorCost: 5,
            clickCost: 50,
            efficiencyCost: 2,
            
            attackPower: 1,
            defense: 0,
            currentEnemy: null,
            victories: 0,
            
            dimensions: {1: false, 2: false},
            artifacts: [],
            
            bots: {autoCollect: false, autoBuy: false, autoBattle: false},
            
            activeChallenge: null,
            completedChallenges: [],
            challengeProgress: {},
            
            stats: {
                totalClicks: 0,
                totalEnemies: 0,
                totalPrestiges: 0,
                playTime: 0,
                productionHistory: []
            },
            
            currentEvent: null,
            eventTimer: 0,
            
            conversionCost: 1000,
            
            achievements: {}
        };
        
        const achievements = [
            {id: 'first', name: 'Premier pas', desc: 'R√©colter 10 Aura'},
            {id: 'collector10', name: 'Industriel', desc: 'Poss√©der 10 collecteurs'},
            {id: 'essence1', name: 'Essence pure', desc: 'Obtenir 1 Essence'},
            {id: 'prestige1', name: 'Ascension', desc: 'Effectuer un prestige'},
            {id: 'aura1m', name: 'Millionnaire', desc: 'Atteindre 1M Aura'},
            {id: 'warrior', name: 'Guerrier', desc: 'Vaincre 10 ennemis'},
            {id: 'artifact1', name: 'Collectionneur', desc: 'Trouver 1 artefact'},
            {id: 'dimension1', name: 'Voyageur dimensionnel', desc: 'D√©bloquer une dimension'},
            {id: 'automated', name: 'Automatis√©', desc: 'Activer un bot'}
        ];
        
        const artifactTypes = [
            {name: 'Orbe de puissance', effect: 'mult', value: 1.5, desc: '√ó1.5 production'},
            {name: 'Cristal dimensionnel', effect: 'dim', value: 2, desc: '√ó2 ressources dimensionnelles'},
            {name: 'Amulette de combat', effect: 'attack', value: 10, desc: '+10 puissance d\'attaque'},
            {name: 'Anneau d\'essence', effect: 'essence', value: 1.3, desc: '√ó1.3 gain d\'essence'},
            {name: 'Gemme de fortune', effect: 'fragments', value: 2, desc: '√ó2 gain de fragments'}
        ];
        
        const events = [
            {name: 'üí´ Vague d\'√©nergie!', effect: 'mult', value: 2, duration: 30, desc: '√ó2 production pendant 30s'},
            {name: 'üåü Pluie de cristaux!', effect: 'crystals', value: 5, duration: 1, desc: '+5 cristaux'},
            {name: '‚ö° Surtension!', effect: 'instant', value: 1000, duration: 1, desc: '+1000 Aura instantan√©ment'},
            {name: 'üéÅ D√©couverte!', effect: 'fragments', value: 10, duration: 1, desc: '+10 fragments cosmiques'}
        ];
        
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
        }
        
        function notify(message) {
            const div = document.createElement('div');
            div.className = 'notification';
            div.textContent = message;
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 3000);
        }
        
        function triggerRandomEvent() {
            if (game.currentEvent) return;
            if (Math.random() < 0.02) {
                const ev = events[Math.floor(Math.random() * events.length)];
                game.currentEvent = ev;
                game.eventTimer = ev.duration;
                
                const banner = document.getElementById('eventBanner');
                banner.innerHTML = `<div class="event-banner"><strong>${ev.name}</strong><br>${ev.desc}</div>`;
                
                if (ev.effect === 'crystals') game.crystals += ev.value;
                if (ev.effect === 'instant') game.aura += ev.value;
                if (ev.effect === 'fragments') game.fragments += ev.value;
                
                notify(ev.name);
            }
        }
        
        function collectAura() {
            const amount = game.clickPower * getMultiplier();
            game.aura += amount;
            game.totalAura += amount;
            game.stats.totalClicks++;
            updateDisplay();
            checkAchievements();
        }
        
        
        function buyCollector() {
            if (game.aura >= game.collectorCost) {
                game.aura -= game.collectorCost;
                game.collectors++;
                game.collectorCost = Math.floor(game.collectorCost * 1.15);
                updateDisplay();
            }
        }
        
        function buyAmplifier() {
            if (game.aura >= game.amplifierCost) {
                game.aura -= game.amplifierCost;
                game.amplifiers++;
                game.amplifierCost = Math.floor(game.amplifierCost * 1.15);
                updateDisplay();
            }
        }
        
        function buyResonator() {
            if (game.essence >= game.resonatorCost) {
                game.essence -= game.resonatorCost;
                game.resonators++;
                game.resonatorCost = Math.floor(game.resonatorCost * 1.2);
                updateDisplay();
            }
        }
        
        function buyClickPower() {
            if (game.aura >= game.clickCost) {
                game.aura -= game.clickCost;
                game.clickUpgrade++;
                game.clickPower++;
                game.clickCost = Math.floor(game.clickCost * 1.5);
                updateDisplay();
            }
        }
        
        function buyEfficiency() {
            if (game.essence >= game.efficiencyCost) {
                game.essence -= game.efficiencyCost;
                game.efficiencyUpgrade++;
                game.efficiencyCost = Math.floor(game.efficiencyCost * 2);
                updateDisplay();
            }
        }

// ===== Petits helpers =====
function escapeHtml(str) {
    if (!str && str !== 0) return '';
    return String(str).replace(/[&<>"'`]/g, function (s) {
        return ({
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;',
            '`': '&#x60;'
        })[s];
    });
}

function getPrestigeClass(prestige) {
    prestige = Number(prestige) || 0;
    if (prestige >= 500) return 'prestige-legend';
    if (prestige >= 100) return 'prestige-gold';
    if (prestige >= 50) return 'prestige-silver';
    if (prestige >= 10) return 'prestige-bronze';
    return 'prestige-default';
}

function convertToEssence() {
    // conversion : 1000 Aura -> 1 Essence par clic
    if (game.aura < 1000) return;
    const convertCount = 1; // mettre Math.floor(game.aura / 1000) pour tout convertir d‚Äôun coup
    game.aura -= 1000 * convertCount;
    game.essence += 1 * convertCount;
    updateDisplay();
    notify(`‚ú® +${convertCount} Essence(s)`);
}

        
        function findEnemy() {
            const level = Math.floor(game.victories / 5) + 1;
            const hp = 10 * level * (1 + Math.random());
            const power = 2 * level;
            const reward = Math.floor(5 * level * (1 + Math.random()));
            
            game.currentEnemy = {
                name: ['Ombre cosmique', 'D√©mon astral', 'Gardien √©th√©r√©', 'Entit√© du chaos'][Math.floor(Math.random() * 4)],
                hp: hp,
                maxHp: hp,
                power: power,
                reward: reward,
                level: level
            };
            
            updateDisplay();
        }
        
        function attackEnemy() {
            if (!game.currentEnemy) return;
            
            const damage = game.attackPower - game.currentEnemy.power + game.defense;
            if (damage > 0) {
                game.currentEnemy.hp -= damage;
                
                if (game.currentEnemy.hp <= 0) {
                    game.fragments += game.currentEnemy.reward;
                    game.victories++;
                    game.stats.totalEnemies++;
                    notify(`Victoire! +${game.currentEnemy.reward} fragments`);
                    game.currentEnemy = null;
                    
                    if (game.activeChallenge === 2) {
                        game.challengeProgress[2] = (game.challengeProgress[2] || 0) + 1;
                    }
                }
            } else {
                notify('Trop puissant! Am√©liorez votre √©quipement!');
            }
            
            updateDisplay();
            checkAchievements();
        }
        
        function buyWeapon() {
            if (game.essence >= 10) {
                game.essence -= 10;
                game.attackPower += 5;
                notify('√âp√©e cosmique obtenue!');
                updateDisplay();
            }
        }
        
        function buyArmor() {
            if (game.essence >= 10) {
                game.essence -= 10;
                game.defense += 3;
                notify('Armure √©nerg√©tique obtenue!');
                updateDisplay();
            }
        }
        
        function unlockDimension(dim) {
            const cost = dim === 1 ? 50 : 200;
            if (game.crystals >= cost && !game.dimensions[dim]) {
                game.crystals -= cost;
                game.dimensions[dim] = true;
                notify(`Dimension ${dim} d√©bloqu√©e!`);
                updateDisplay();
                checkAchievements();
            }
        }
        
        function buyEtherGen() {
            if (game.ether >= 100) {
                game.ether -= 100;
                game.etherGens++;
                updateDisplay();
            }
        }
        
        function buyAstralGen() {
            if (game.astral >= 500) {
                game.astral -= 500;
                game.astralGens++;
                updateDisplay();
            }
        }
        
        function searchArtifact() {
            if (game.fragments >= 50) {
                game.fragments -= 50;
                const artifact = artifactTypes[Math.floor(Math.random() * artifactTypes.length)];
                game.artifacts.push(artifact);
                notify(`Artefact trouv√©: ${artifact.name}!`);
                updateDisplay();
                checkAchievements();
            }
        }
        
        function unlockBot(type) {
            const costs = {autoCollect: 1, autoBuy: 5, autoBattle: 10};
            if (game.essence >= costs[type] && !game.bots[type]) {
                game.essence -= costs[type];
                game.bots[type] = true;
                notify(`Bot activ√©: ${type}!`);
                updateDisplay();
                checkAchievements();
            }
        }
        
        function startChallenge(id) {
            game.activeChallenge = id;
            game.challengeProgress[id] = 0;
            
            if (id === 3) game.challengeProgress[id] = Date.now();
            
            notify(`D√©fi ${id} commenc√©!`);
            updateDisplay();
        }
        
        function checkChallengeCompletion() {
            if (game.activeChallenge === 1 && game.aura >= 10000 && game.collectors === 0) {
                game.completedChallenges.push(1);
                game.clickPower = Math.floor(game.clickPower * 1.5);
                notify('D√©fi 1 compl√©t√©! +50% clics');
                game.activeChallenge = null;
            }
            
            if (game.activeChallenge === 2 && game.challengeProgress[2] >= 50) {
                game.completedChallenges.push(2);
                game.attackPower *= 2;
                notify('D√©fi 2 compl√©t√©! x2 attaque');
                game.activeChallenge = null;
            }
            
            if (game.activeChallenge === 3 && game.totalAura >= 1000000) {
                const elapsed = (Date.now() - game.challengeProgress[3]) / 1000;
                if (elapsed <= 300) {
                    game.completedChallenges.push(3);
                    notify('D√©fi 3 compl√©t√©! x2 production');
                    game.activeChallenge = null;
                }
            }
        }
        
        function getMultiplier() {
            let mult = 1;
            mult *= 1 + (game.crystals * 0.1);
            mult *= Math.pow(1.5, game.efficiencyUpgrade);
            
            if (game.currentEvent && game.currentEvent.effect === 'mult') {
                mult *= game.currentEvent.value;
            }
            
            game.artifacts.forEach(a => {
                if (a.effect === 'mult') mult *= a.value;
            });
            
            if (game.completedChallenges.includes(3)) mult *= 2;
            
            return mult;
        }
        
        function getAuraPerSecond() {
            let rate = 0;
            rate += game.collectors * 1;
            rate += game.amplifiers * 10;
            rate += game.resonators * 100;
            rate *= getMultiplier();
            return rate;
        }
        
        function prestige() {
            if (game.totalAura >= 1000000) {
                const crystalsGained = Math.floor(Math.sqrt(game.totalAura / 100000));
                game.crystals += crystalsGained;
                game.stats.totalPrestiges++;
                
                game.aura = 0;
                game.essence = 0;
                game.totalAura = 0;
                game.clickPower = 1;
                game.collectors = 0;
                game.amplifiers = 0;
                game.resonators = 0;
                game.clickUpgrade = 0;
                game.efficiencyUpgrade = 0;
                game.collectorCost = 10;
                game.amplifierCost = 100;
                game.resonatorCost = 5;
                game.clickCost = 50;
                game.efficiencyCost = 2;
                
                notify(`Prestige! +${crystalsGained} cristaux`);
                updateDisplay();
                checkAchievements();
            }
        }
        
        function checkAchievements() {
            if (!game.achievements.first && game.totalAura >= 10) {
                game.achievements.first = true;
                notify('üèÜ Succ√®s: Premier pas');
            }
            if (!game.achievements.collector10 && game.collectors >= 10) {
                game.achievements.collector10 = true;
                notify('üèÜ Succ√®s: Industriel');
            }
            if (!game.achievements.essence1 && game.essence >= 1) {
                game.achievements.essence1 = true;
                notify('üèÜ Succ√®s: Essence pure');
            }
            if (!game.achievements.prestige1 && game.crystals > 0) {
                game.achievements.prestige1 = true;
                notify('üèÜ Succ√®s: Ascension');
            }
            if (!game.achievements.aura1m && game.totalAura >= 1000000) {
                game.achievements.aura1m = true;
                notify('üèÜ Succ√®s: Millionnaire');
            }
            if (!game.achievements.warrior && game.stats.totalEnemies >= 10) {
                game.achievements.warrior = true;
                notify('üèÜ Succ√®s: Guerrier');
            }
            if (!game.achievements.artifact1 && game.artifacts.length >= 1) {
                game.achievements.artifact1 = true;
                notify('üèÜ Succ√®s: Collectionneur');
            }
            if (!game.achievements.dimension1 && (game.dimensions[1] || game.dimensions[2])) {
                game.achievements.dimension1 = true;
                notify('üèÜ Succ√®s: Voyageur dimensionnel');
            }
            if (!game.achievements.automated && (game.bots.autoCollect || game.bots.autoBuy || game.bots.autoBattle)) {
                game.achievements.automated = true;
                notify('üèÜ Succ√®s: Automatis√©');
            }
            updateAchievements();
        }
        
        function updateAchievements() {
            const list = document.getElementById('achievementList');
            list.innerHTML = '';
            achievements.forEach(a => {
                const div = document.createElement('div');
                div.className = 'achievement' + (game.achievements[a.id] ? '' : ' locked');
                div.innerHTML = `<strong>${a.name}</strong>: ${a.desc}`;
                list.appendChild(div);
            });
        }
        
        function updateArtifactDisplay() {
            const list = document.getElementById('artifactList');
            list.innerHTML = '';
            if (game.artifacts.length === 0) {
                list.innerHTML = '<div style="color: #a0a0a0; text-align: center; padding: 20px;">Aucun artefact trouv√©</div>';
            } else {
                game.artifacts.forEach((a, i) => {
                    const div = document.createElement('div');
                    div.className = 'artifact';
                    div.innerHTML = `<div class="artifact-name">${a.name}</div><div style="color: #a0a0a0; font-size: 0.9em;">${a.desc}</div>`;
                    list.appendChild(div);
                });
            }
        }
        
        function updateDisplay() {
            document.getElementById('aura').textContent = Math.floor(game.aura).toLocaleString();
            document.getElementById('essence').textContent = game.essence.toLocaleString();
            document.getElementById('crystals').textContent = game.crystals;
            document.getElementById('fragments').textContent = game.fragments;
            document.getElementById('fragmentsDisplay').textContent = game.fragments;
            
            const aps = getAuraPerSecond();
            document.getElementById('auraRate').textContent = aps.toFixed(1);
            
            document.getElementById('collectors').textContent = game.collectors;
            document.getElementById('amplifiers').textContent = game.amplifiers;
            document.getElementById('resonators').textContent = game.resonators;
            document.getElementById('multiplier').textContent = '√ó' + getMultiplier().toFixed(2);
            
            document.getElementById('collectorLevel').textContent = game.collectors;
            document.getElementById('amplifierLevel').textContent = game.amplifiers;
            document.getElementById('resonatorLevel').textContent = game.resonators;
            document.getElementById('clickLevel').textContent = game.clickUpgrade;
            document.getElementById('efficiencyLevel').textContent = game.efficiencyUpgrade;
            
            document.getElementById('collectorCost').textContent = game.collectorCost.toLocaleString();
            document.getElementById('amplifierCost').textContent = game.amplifierCost.toLocaleString();
            document.getElementById('resonatorCost').textContent = game.resonatorCost.toLocaleString();
            document.getElementById('clickCost').textContent = game.clickCost.toLocaleString();
            document.getElementById('efficiencyCost').textContent = game.efficiencyCost.toLocaleString();
            
            document.getElementById('attackPower').textContent = game.attackPower;
            document.getElementById('defense').textContent = game.defense;
            document.getElementById('victories').textContent = game.victories;
            
            if (game.currentEnemy) {
                const pct = (game.currentEnemy.hp / game.currentEnemy.maxHp) * 100;
                document.getElementById('enemyInfo').innerHTML = `
                    <div class="enemy">
                        <div class="enemy-name">${game.currentEnemy.name} Niv.${game.currentEnemy.level}</div>
                        <div class="stat">
                            <span>PV:</span>
                            <span>${Math.ceil(game.currentEnemy.hp)}/${Math.ceil(game.currentEnemy.maxHp)}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${pct}%; background: linear-gradient(90deg, #ff4757, #ff6348);">${pct.toFixed(0)}%</div>
                        </div>
                        <div class="stat">
                            <span>Puissance:</span>
                            <span>${game.currentEnemy.power}</span>
                        </div>
                        <div class="stat">
                            <span>R√©compense:</span>
                            <span>${game.currentEnemy.reward} fragments</span>
                        </div>
                        <button class="btn-danger" onclick="attackEnemy()">Attaquer!</button>
                    </div>
                `;
            } else {
                document.getElementById('enemyInfo').innerHTML = '<div style="text-align: center; color: #a0a0a0; padding: 40px;">Aucun ennemi actif</div>';
            }
            
            document.getElementById('ether').textContent = Math.floor(game.ether);
            document.getElementById('etherGens').textContent = game.etherGens;
            document.getElementById('astral').textContent = Math.floor(game.astral);
            document.getElementById('astralGens').textContent = game.astralGens;
            
            document.getElementById('dim1Btn').disabled = game.dimensions[1] || game.crystals < 50;
            document.getElementById('dim2Btn').disabled = game.dimensions[2] || game.crystals < 200 || !game.dimensions[1];
            document.getElementById('etherGenBtn').disabled = !game.dimensions[1] || game.ether < 100;
            document.getElementById('astralGenBtn').disabled = !game.dimensions[2] || game.astral < 500;
            
            if (game.dimensions[1]) document.getElementById('dim1Btn').textContent = 'D√©bloqu√© ‚úì';
            if (game.dimensions[2]) document.getElementById('dim2Btn').textContent = 'D√©bloqu√© ‚úì';
            
            document.getElementById('bot1Btn').disabled = game.bots.autoCollect || game.essence < 1;
            document.getElementById('bot2Btn').disabled = game.bots.autoBuy || game.essence < 5;
            document.getElementById('bot3Btn').disabled = game.bots.autoBattle || game.essence < 10;
            
            if (game.bots.autoCollect) document.getElementById('bot1Btn').textContent = 'Actif ‚úì';
            if (game.bots.autoBuy) document.getElementById('bot2Btn').textContent = 'Actif ‚úì';
            if (game.bots.autoBattle) document.getElementById('bot3Btn').textContent = 'Actif ‚úì';
            
            const crystalsGained = game.totalAura >= 1000000 ? Math.floor(Math.sqrt(game.totalAura / 100000)) : 0;
            document.getElementById('prestigeGain').textContent = crystalsGained;
            document.getElementById('crystalBonus').textContent = '+' + (game.crystals * 10) + '%';
            document.getElementById('prestigeBtn').disabled = game.totalAura < 1000000;
            
            const prestigePercent = Math.min(100, (game.totalAura / 1000000) * 100);
            document.getElementById('prestigeProgress').style.width = prestigePercent + '%';
            document.getElementById('prestigeProgress').textContent = prestigePercent.toFixed(1) + '%';
            
            document.getElementById('totalAuraCollected').textContent = Math.floor(game.totalAura).toLocaleString();
            document.getElementById('totalClicks').textContent = game.stats.totalClicks.toLocaleString();
            document.getElementById('totalEnemies').textContent = game.stats.totalEnemies;
            document.getElementById('totalPrestiges').textContent = game.stats.totalPrestiges;
            document.getElementById('playTime').textContent = Math.floor(game.stats.playTime) + 's';
            
            updateArtifactDisplay();
            const convertBtn = document.getElementById('convertBtn');
if (convertBtn) {
    convertBtn.disabled = game.aura < game.conversionCost;
}

        }
        
        function drawChart() {
            const canvas = document.getElementById('productionChart');
            const ctx = canvas.getContext('2d');
            const history = game.stats.productionHistory.slice(-30);
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (history.length < 2) return;
            
            const max = Math.max(...history, 1);
            const step = canvas.width / (history.length - 1);
            
            ctx.strokeStyle = '#7b2ff7';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            history.forEach((val, i) => {
                const x = i * step;
                const y = canvas.height - (val / max * canvas.height * 0.9);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            
            ctx.stroke();
            
            ctx.fillStyle = 'rgba(123, 47, 247, 0.2)';
            ctx.lineTo(canvas.width, canvas.height);
            ctx.lineTo(0, canvas.height);
            ctx.closePath();
            ctx.fill();
        }
        
        setInterval(() => {
            const aps = getAuraPerSecond();
            game.aura += aps / 10;
            game.totalAura += aps / 10;
            
            if (game.bots.autoCollect) {
                const amount = game.clickPower * getMultiplier();
                game.aura += amount;
                game.totalAura += amount;
            }
            
            if (game.bots.autoBuy && game.aura >= game.collectorCost) {
                buyCollector();
            }
            
            if (game.bots.autoBattle && game.currentEnemy) {
                attackEnemy();
            } else if (game.bots.autoBattle && !game.currentEnemy) {
                findEnemy();
            }
            
            if (game.dimensions[1]) {
                game.ether += game.etherGens * 0.1;
            }
            
            if (game.dimensions[2]) {
                game.astral += game.astralGens * 0.5;
            }
            
            if (game.currentEvent) {
                game.eventTimer -= 0.1;
                if (game.eventTimer <= 0) {
                    game.currentEvent = null;
                    document.getElementById('eventBanner').innerHTML = '';
                }
            }
            
            game.stats.playTime += 0.1;
            
            updateDisplay();
            checkAchievements();
            checkChallengeCompletion();
        }, 100);
        
        setInterval(() => {
            triggerRandomEvent();
            game.stats.productionHistory.push(getAuraPerSecond());
            if (game.stats.productionHistory.length > 30) {
                game.stats.productionHistory.shift();
            }
            drawChart();
        }, 1000);
        
        updateDisplay();
        updateAchievements();
        drawChart();
    </script>
<body>

</body>

</body>
</html>
        
    </script>
</body>

</html>
























